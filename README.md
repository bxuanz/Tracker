# <div align="center">Tracker 🛰️📅</div>

<div align="center">


![PyQt6](https://img.shields.io/badge/GUI-PyQt6-green)
![License](https://img.shields.io/badge/License-MIT-orange)


**一款通用的时序影像事件标注工具：从大尺度遥感影像到普通图像全覆盖**

</div>

**Tracker** 是一个高性能的轻量级标注工具，**完美兼容从 GB 级大尺度遥感影像（GeoTIFF）到普通小尺寸图像（JPG/PNG）的各类数据**。

它不仅解决了 LabelImg/LabelMe 在加载超大影像时的内存瓶颈，也提供了比传统工具更流畅的时序标注体验。Tracker 专为 **“位置固定、属性变化”** 的时序事件（如建筑施工进度、植被生长监测、监控定点观察）设计，采用 **“一次画框，全序列同步”** 的逻辑，大幅提升标注效率。

## ✨ 核心特性 (Key Features)

### 🚀 高性能与兼容性
* **大图无压力**：采用智能动态降采样与显存纹理限制技术，轻松流畅加载 100MB+ 甚至 GB 级别的 `.tif` 影像。
* **多格式支持**：完美支持 `.tif`, `.tiff`, `.png`, `.jpg`, `.jpeg`。
* **智能排序**：内置正则引擎，自动识别文件名中的日期（如 `2005-12-20`），确保时序排列严格准确，而非简单的字符排序。

### ⚡ 高效时序标注
* **批量创建 (Batch Mode)**：画一次框，拖动滑块即可自动填充该事件在未来 N 帧中的存在，极大提高效率。
* **离散拼接 (Discrete Append)**：支持对同一个事件添加非连续的时间片段（例如：第1-3天出现，第8-10天再次出现）。
* **全序列同步 (Sync Edit)**：修改任意一帧的框大小或位置，该事件在所有时间点上的框都会自动同步更新（基于固定区域假设）。

### 🛠️ 精细化管理
* **双层级描述**：强制要求 **Category**（短语类别，如"建筑施工"）和 **Caption**（详细长句描述），确保数据集质量。
* **时间轴微调**：提供丰富的右键菜单，支持“设为起点”、“设为终点”、“单帧移除”等操作，且具备自动补全逻辑。
* **质量控制**：内置“🚩 标记低质量”功能，可将云雾遮挡或成像模糊的帧标记为 `poor`，直接写入数据文件。

---

## 🛠️ 安装与配置 (Installation)

### 1. 克隆仓库
```bash
git clone https://github.com/bxuanz/Tracker.git
cd Tracker
```

### 2. 创建虚拟环境 (推荐)
```bash
conda create -n tracker_env python=3.9
conda activate tracker_env
```

### 3. 安装依赖
```bash
pip install -r requirements.txt
```
*(核心依赖：`PyQt6`, `numpy`, `rasterio`, `Pillow`)*

---

## 🏃‍♂️ 操作指南 (User Guide)

### 1. 启动与加载
```bash
python main.py
```
* 点击 **"Open Folder"** 选择图像文件夹。
* 程序会自动扫描并在底部生成时间轴导航条。
* **注意**：底部状态栏会实时显示当前光标的 **真实图像坐标 (X, Y)** 及 **图像分辨率**。

### 2. 标注工作流

#### A. 创建新事件
1.  在图像上按住左键 **画框**。
2.  在弹出的对话框中：
    * 选择 **"创建新事件"**。
    * 填写 **Category** (支持输入新类别) 和 **Caption** (必填)。
    * 拖动滑块选择 **结束帧**。
3.  点击确认，程序自动生成连续标注。

#### B. 追加离散片段 (Append)
*场景：事件在第 1-5 帧存在，消失几天后，在第 10 帧又出现了。*
1.  跳转到第 10 帧。
2.  在图中画框。
3.  在弹窗的下拉列表中，选择 **"ID x: [已有事件名称]"**。
4.  选择该片段的结束帧（例如第 12 帧）。
5.  点击确认，该事件现在覆盖 `[1-5, 10-12]`。

#### C. 修改与调整
* **调整框大小**：点击选中框（变为实线，出现青色手柄），拖动右下角手柄或移动框体。**修改会立即应用到该事件的所有帧**。
* **质量标记**：遇到模糊图片，点击顶部工具栏的 **"🚩 Mark Poor Quality"** 按钮。

### 3. 时间轴管理 (右键菜单)
在右侧事件列表点击鼠标右键，可进行精细操作：

| 菜单项 | 功能描述 |
| :--- | :--- |
| **❌ Remove Box on Current Frame** | 仅删除当前这一帧的标注（用于中间某天物体被遮挡）。 |
| **⚡ Set Current as START** | 将当前帧设为起点。若当前帧在原起点之前，自动向前补全；若在之后，自动裁切前面。 |
| **⚡ Set Current as END** | 将当前帧设为终点。自动补全中间的空隙，并删除当前帧之后的数据。 |
| **🗑️ Delete Event Completely** | 彻底删除该事件及其所有数据。 |

---

## ⌨️ 快捷键 (Shortcuts)

| 按键 | 功能 |
| :--- | :--- |
| `←` / `↑` | 上一张图像 (Prev Frame) |
| `→` / `↓` | 下一张图像 (Next Frame) |
| `Delete` | (预留) 删除操作 |
| `鼠标左键` | 画框 / 选中框 / 拖拽调整 |
| `鼠标右键` | 拖拽平移视图 (Pan) |
| `鼠标滚轮` | 以光标为中心缩放 (Zoom) |

---

## 📂 数据格式 (Output Format)

点击 "Save Data" 后，会在图像目录下生成 `annotations.json`。V9 版本采用了**以事件为核心**的存储结构。

```json
{
    "1": {
        "category": "建筑施工",
        "caption": "跑道西北侧出现大型挖掘机进行挖掘作业",
        "box": [5000, 3000, 250, 250],  // [x, y, w, h] (固定区域)
        "frames": [
            {
                "filename": "2024-01-01.tif",
                "quality": "good"
            },
            {
                "filename": "2024-01-02.tif",
                "quality": "poor"  // 被标记为低质量
            },
            {
                "filename": "2024-01-05.tif",
                "quality": "good"
            }
        ]
    },
    "2": {
        "category": "植被变化",
        "caption": "林地被平整为裸土",
        "box": [1200, 800, 100, 100],
        "frames": [ ... ]
    }
}
```

---

## 🤝 贡献 (Contributing)

欢迎提交 Issue 或 Pull Request！
如果您发现某些特殊的遥感影像格式无法加载，请附上 `gdalinfo` 信息或样本文件。

## 📄 许可证 (License)

本项目采用 [MIT License](LICENSE) 开源。